<html>

<head>
	<script src="../src/Graph.js" />
	</script>
	<script src="data-json-criminal.js"></script>
	<script src="data-json-org-chart.js"></script>
	<script src="data-json-simple-tree.js"></script>
	<script src="../src/layout/TreeLayout.js"></script>


	<link rel="stylesheet" href="./style.css">

	<style>
		pre {
			margin: 0px;
		}

		.card {
			border: 2px solid rgb(96, 139, 168);
			border-radius: 5px;
		}

		.card .content {
			padding: 10px;
		}

		.card .title {
			background-color: rgba(96, 139, 168, .2);
			padding: 10px;
		}

		.container {
			display: inline-flex;
			justify-content: space-between;
			_outline: 1px dotted DodgerBlue;
			width: 80%;
			height: 80%;
		}

		.container>div {
			margin: 10px;
			width: 100%;
			_background: #46B980;
			padding: 5px;
			_color: #fff;
		}

		#canvas {
			outline: 1px dotted DodgerBlue;

		}
	</style>
</head>

<body>
	<h1>Test Tree Layout</h1>
	<ul class="breadcrumb">
		<li><a href="../index.html">Home</a></li>
		<li>Test Graph</li>
	</ul>
	<canvas id="canvas" width="1000" height="800"></canvas>

	<script>


		function drawLine(ctx, begin, end, stroke = 'black', width = 1) {
			ctx.save();

			if (stroke) {
				ctx.strokeStyle = stroke;
			}

			if (width) {
				ctx.lineWidth = width;
			}

			ctx.beginPath();
			ctx.moveTo(...begin);
			ctx.lineTo(...end);
			ctx.stroke();
			ctx.restore();
		}
		console.log("==========================");
		//	var nodeZ = new Node("Z", {});
		//	nodeZ.attr("width", 666);
		console.log("==========================");

		var graph_walker = new Graph();
		// Root Node
		graph_walker.addObject({ id: "O", parentId: null, type: "standard" });

		// 1st Level
		graph_walker.addObject({ id: "E", parentId: "O", type: "standard" });
		graph_walker.addObject({ id: "F", parentId: "O", type: "standard" });
		graph_walker.addObject({ id: "N", parentId: "O", type: "standard" });
		

		// 2nd Level
		graph_walker.addObject({ id: "A", parentId: "E", type: "standard" });
		graph_walker.addObject({ id: "D", parentId: "E", type: "standard" });

		graph_walker.addObject({ id: "G", parentId: "N", type: "standard" });
		graph_walker.addObject({ id: "M", parentId: "N", type: "standard" });

		// 3rd Level
		graph_walker.addObject({ id: "B", parentId: "D", type: "standard" });
		graph_walker.addObject({ id: "C", parentId: "D", type: "standard" });
		//
		graph_walker.addObject({ id: "H", parentId: "M", type: "standard" });
		graph_walker.addObject({ id: "I", parentId: "M", type: "standard" });
		graph_walker.addObject({ id: "J", parentId: "M", type: "standard" });
		graph_walker.addObject({ id: "K", parentId: "M", type: "standard" });
		graph_walker.addObject({ id: "L", parentId: "M", type: "standard" });


		// New Nodes
		graph_walker.addObject({ id: "X", parentId: "N", type: "NEW" });
		graph_walker.addObject({ id: "Y", parentId: "N", type: "NEW" });


		/*
				console.log("==========================");
				console.log("=Test getLeftmost");
				console.log("==========================");
		
				var node = graph_walker.getNode("M");
				var Leftmost =  treeLayout.getLeftmost_ONE(node, 0, 2);
				console.log("==> Test getLeftmost " + node.id + " = " + Leftmost);
		*/
		var treeLayout = new TreeLayout(graph_walker);
		treeLayout.Calculate_Positions(graph_walker, { x: 100, y: 100 });
		var treeDimension = treeLayout.getTreeDimension();
		console.log("treeDimension ==> " + treeDimension);
		console.log(treeDimension);


		var canvas = document.getElementById('canvas');
		var context = canvas.getContext('2d');
		let rect = canvas.getBoundingClientRect();

		// increase the actual size of our canvas
		canvas.width = rect.width * devicePixelRatio;
		canvas.height = rect.height * devicePixelRatio;
		context.scale(devicePixelRatio, devicePixelRatio);
		canvas.style.width = rect.width + 'px';
		canvas.style.height = rect.height + 'px';

		context.strokeStyle = 'rgb(41, 62, 64)';

		context.shadowColor = "#999";
		context.shadowBlur = 20;
		context.shadowOffsetX = 10;
		context.shadowOffsetY = 10;


		var x1, y1, x2, y2, x3, y3, x4, y4;
		for (let index = 0; index < graph_walker.nodeList.length; index++) {
			const node = graph_walker.nodeList[index];

			if (node.data.type && node.data.type == "NEW") {
				context.fillStyle = 'rgb(128, 182, 161)';
			}
			else {
				context.fillStyle = '#0181a0';
			}
			//context.fillRect(node.x, node.y, node.width, node.height);

		//	node.width = 5;
		//	node.height = 5;

			context.fillRect(node.x, node.y, node.width, node.height);
			//context.beginPath();
			context.font = 'bold 20px Calibri';
			context.save();
			context.fillStyle = 'rgb(255, 250, 255)';

			context.textBaseline = "middle";
			context.textAlign = "center";
			var textWidth = 0;
			//var textWidth = context.measureText(node.id ).width;
			context.fillText(node.id, node.x + (node.width / 2) - (textWidth / 2), node.y + node.height / 2);


			// Middle Of Node
			x1 = node.x + (node.width / 2);
			y1 = node.y + node.height;
			var middleOfNode =  [x1, y1];

			for (var i = 0; i < node.children.length; i++) {
				var childNode = node.children[i];
				x2 = childNode.x + node.width / 2;
				y2 = childNode.y;
				var middleOfChild =  [x2, y2];
				drawLine(context, middleOfNode, middleOfChild, 'green', 1);
			}
		}
		//console.log(graph_walker.nodeList);
	</script>
</body>